(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[69],{"0232":function(e,t,n){var a=n("4ea4").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,n("ac1f"),n("841c"),n("d3b7"),n("159b");var i=a(n("5530")),s=a(n("2aed")),r=a(n("903f")),c={name:"index",components:{TableList:s.default,WechatEmpty:r.default},data:function(){return{search:{nickname:""},tab:"0",table:{list:[],total:0,loading:!1},page:{pageSize:10,pageNumber:1},tabList:[{id:"0",name:"粉丝"},{id:"1",name:"黑名单"}],loading:!1,isIdentifyService:!1,lastSyncTime:""}},created:function(){var e=this;this.$store.dispatch("channel/getWechatInfo").then((function(t){var n=t.isIdentifyService;e.isIdentifyService=n,n&&e.getList()}))},computed:{noManagePerm:function(){return!this.$getPermMap("channel.wechat.manage")}},methods:{tabClick:function(e){this.tab=e,this.handleRefresh()},syncFans:function(){var e=this;this.loading=!0,this.$api.homeApi.syncWechatFans().then((function(t){0===t.error?e.getTaskInfo(t.task_id):e.loading=!1}))},getTaskInfo:function(e){var t=this;this.$api.homeApi.getTaskInfo({task_id:e}).then((function(n){var a,i,s;0===n.error?0===+(null===(a=n.data)||void 0===a?void 0:a.status)?setTimeout((function(){t.getTaskInfo(e)}),3e3):1===+(null===(i=n.data)||void 0===i?void 0:i.status)?(t.$Message.success("同步成功"),t.handleRefresh(),t.loading=!1):2===+(null===(s=n.data)||void 0===s?void 0:s.status)?(t.$Message.error("同步失败"),t.loading=!1):t.loading=!1:t.loading=!1}))},getList:function(){var e=this;this.table.loading=!0;var t=(0,i.default)({pagesize:this.page.pageSize,page:this.page.pageNumber,is_black:"0"===this.tab?0:1},this.search);this.$api.homeApi.getWechatFansList(t).then((function(t){0===t.error&&(e.table.list=t.list||[],e.table.total=t.total,e.lastSyncTime=t.last_sync_time||"")})).finally((function(){e.table.loading=!1,e.$refs["table_list"].resetChecked()}))},handleRefresh:function(){this.resetPage(),this.getList()},handleSearch:function(){this.handleRefresh()},resetSearch:function(){this.search={nickname:""},this.handleRefresh()},changePage:function(e){this.page=e,this.getList()},resetPage:function(){this.page={pageSize:10,pageNumber:1},this.$refs["table_list"].resetPage()},changeCheckbox:function(e){var t=this;this.table.list.forEach((function(n,a){t.$set(t.table.list[a],"_checked",e)})),console.log("table-list",this.table.list)}}};t.default=c},"07ff":function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.staticRenderFns=t.render=void 0;var n=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"table-list"},[t("Table",{ref:"table",attrs:{columns:e.columns,data:e.data},on:{"on-selection-change":e.selectChange},scopedSlots:e._u([{key:"nickname",fn:function(n){var a=n.row;return[t("div",{staticClass:"nickname"},[t("div",{staticClass:"logo"},[t("img",{attrs:{src:e.$utils.media(a.avatar),alt:""},on:{error:function(t){return e.replaceImage("avatar")}}})]),t("div",{staticClass:"name"},[e._v(" "+e._s(a.nickname)+" ")])])]}},{key:"fans_label",fn:function(n){var a=n.row;return[t("div",{staticClass:"line-hide"},[e._v(e._s(e.getLabelName(a.tag)))])]}},{key:"attention_status",fn:function(n){var a=n.row;return[1===+a.is_follow?t("kdx-status-text",{attrs:{type:"success"}},[e._v("已关注")]):t("kdx-status-text",{attrs:{type:"danger"}},[e._v("取消关注")])]}},{key:"unfollow_time",fn:function(n){var a=n.row;return[t("div",[e._v(e._s(a.unfollow_time&&"0000-00-00 00:00:00"!==a.unfollow_time?a.unfollow_time:"-"))])]}},{key:"action",fn:function(n){var a=n.row;return[t("Button",{attrs:{type:"text",disabled:e.noManagePerm},on:{click:function(t){return e.addLabel({row:a})}}},[e._v("打标签")]),0===+a.is_black?t("Button",{staticClass:"marginL-10",attrs:{type:"text",disabled:e.noManagePerm},on:{click:function(t){return e.setBlack({row:a,is_black:1})}}},[e._v("加入黑名单")]):t("Button",{staticClass:"marginL-10",attrs:{type:"text",disabled:e.noManagePerm},on:{click:function(t){return e.setBlack({row:a,setBlack:0})}}},[e._v("移除黑名单")])]}}])}),t("div",{directives:[{name:"show",rawName:"v-show",value:e.data.length>0,expression:"data.length > 0"}],staticClass:"footer-action"},[t("Checkbox",{on:{"on-change":e.checkboxChange},model:{value:e.isSelectAll,callback:function(t){e.isSelectAll=t},expression:"isSelectAll"}}),t("Button",{attrs:{disabled:!e.isChecked||e.noManagePerm},on:{click:function(t){return e.addLabel({type:"multiple"})}}},[e._v("打标签")]),"0"===e.tab?t("Button",{attrs:{disabled:!e.isChecked||e.noManagePerm},on:{click:function(t){return e.setBlack({type:"multiple",is_black:1})}}},[e._v("加入黑名单")]):"1"===e.tab?t("Button",{attrs:{disabled:!e.isChecked||e.noManagePerm},on:{click:function(t){return e.setBlack({type:"multiple",is_black:0})}}},[e._v("移除黑名单")]):e._e()],1),t("div",{directives:[{name:"show",rawName:"v-show",value:e.total>10,expression:"total > 10"}],staticClass:"footer-page"},[t("kdx-page-component",{ref:"page",attrs:{current:e.current,pageSize:e.pageSize,total:e.total},on:{"on-change":e.changePage}})],1),t("fans-label",{ref:"fans_label",attrs:{id:e.checkedId,"current-list":e.tabList},on:{"on-refresh":e.handleRefresh}})],1)};t.render=n;var a=[];t.staticRenderFns=a},"1c67":function(e,t,n){"use strict";n.r(t);var a=n("8e14"),i=n.n(a);for(var s in a)["default"].indexOf(s)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(s);t["default"]=i.a},"2aed":function(e,t,n){"use strict";n.r(t);var a=n("8386"),i=n("4028");for(var s in i)["default"].indexOf(s)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(s);n("a7e8");var r=n("2877"),c=Object(r["a"])(i["default"],a["render"],a["staticRenderFns"],!1,null,"2c80096a",null);t["default"]=c.exports},"2bd5":function(e,t,n){"use strict";var a=n("4468");n.o(a,"render")&&n.d(t,"render",(function(){return a["render"]})),n.o(a,"staticRenderFns")&&n.d(t,"staticRenderFns",(function(){return a["staticRenderFns"]}))},"3b55":function(e,t,n){"use strict";n.r(t);var a=n("0232"),i=n.n(a);for(var s in a)["default"].indexOf(s)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(s);t["default"]=i.a},4028:function(e,t,n){"use strict";n.r(t);var a=n("cdbd"),i=n.n(a);for(var s in a)["default"].indexOf(s)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(s);t["default"]=i.a},4468:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.staticRenderFns=t.render=void 0;var n=function(){var e=this,t=e._self._c;return t("kdx-modal-frame",{attrs:{title:"粉丝标签",width:500,loading:e.loading},on:{"on-cancel":e.setValue,"on-ok":e.handleOk},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}},[t("div",{staticClass:"fans-label"},[t("div",{staticClass:"label-content"},e._l(e.list,(function(n,a){return t("div",{key:a,staticClass:"label-item",class:{checked:e.selectObj[n.wechat_tag_id]},on:{click:function(t){return e.selectLabel(n)}}},[t("span",[e._v(" "+e._s(n.tag_name))]),t("kdx-svg-icon",{staticClass:"icon",attrs:{type:"icon-chenggong-shixin"}})],1)})),0)])])};t.render=n;var a=[];t.staticRenderFns=a},"4ac3":function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.staticRenderFns=t.render=void 0;var a=function(){var e=this;e._self._c;return e._m(0)};t.render=a;var i=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"wechat-empty"},[t("div",{staticClass:"empty-img"},[t("img",{attrs:{src:n("7677"),alt:""}}),t("div",{staticClass:"text"},[e._v(" 您的公众号类型为未认证服务号，暂不支持本功能 ")])])])}];t.staticRenderFns=i},"6ccc":function(e,t,n){},7677:function(e,t,n){e.exports=n.p+"static/dist/shop/img/wechat-no-type.png"},"77ef":function(e,t,n){},"7ec6":function(e,t,n){"use strict";var a=n("ec21");n.o(a,"render")&&n.d(t,"render",(function(){return a["render"]})),n.o(a,"staticRenderFns")&&n.d(t,"staticRenderFns",(function(){return a["staticRenderFns"]}))},8386:function(e,t,n){"use strict";var a=n("07ff");n.o(a,"render")&&n.d(t,"render",(function(){return a["render"]})),n.o(a,"staticRenderFns")&&n.d(t,"staticRenderFns",(function(){return a["staticRenderFns"]}))},"8e14":function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,n("d81d"),n("d3b7"),n("4de4"),n("14d9");var a={name:"LabelModal",props:{id:{type:Array,default:function(){return[]}},currentList:{type:Array,default:function(){return[]}}},data:function(){return{value:!1,loading:!1,list:[],selectRows:[],selectObj:{}}},methods:{setValue:function(){var e=this;this.value=!this.value,this.value&&(console.log("current-list",this.currentList),this.selectObj={},this.selectRows=this.currentList.map((function(t){return e.$set(e.selectObj,t.wechat_tag_id,!0),t})),0===this.list.length&&this.getList())},getList:function(){var e=this;this.loading=!0,this.$api.homeApi.getWechatFansLabelList({pager:0}).then((function(t){0===t.error&&(e.list=t.list||[])})).finally((function(){e.loading=!1}))},handleOk:function(){var e=this,t={fans_id:this.id,wechat_tag_id:this.selectRows.map((function(e){return e.wechat_tag_id}))};this.loading=!0,this.$api.homeApi.setWechatFansLabel(t).then((function(t){0===t.error&&(e.$Message.success("粉丝标签操作成功"),e.setValue(),e.$emit("on-refresh"))})).finally((function(){e.loading=!1}))},selectLabel:function(e){this.selectObj[e.wechat_tag_id]?(this.$set(this.selectObj,e.wechat_tag_id,!1),this.selectRows=this.selectRows.filter((function(t){return t.wechat_tag_id!==e.wechat_tag_id}))):(this.$set(this.selectObj,e.wechat_tag_id,!0),this.selectRows.push(e))}}};t.default=a},"903f":function(e,t,n){"use strict";n.r(t);var a=n("9d65"),i=n("be1b");for(var s in i)["default"].indexOf(s)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(s);n("c76b");var r=n("2877"),c=Object(r["a"])(i["default"],a["render"],a["staticRenderFns"],!1,null,"29b9512d",null);t["default"]=c.exports},"99cf":function(e,t,n){},"9ab95":function(e,t,n){},"9d65":function(e,t,n){"use strict";var a=n("4ac3");n.o(a,"render")&&n.d(t,"render",(function(){return a["render"]})),n.o(a,"staticRenderFns")&&n.d(t,"staticRenderFns",(function(){return a["staticRenderFns"]}))},a261:function(e,t,n){"use strict";n("9ab95")},a7e8:function(e,t,n){"use strict";n("6ccc")},b888:function(e,t,n){"use strict";n.r(t);var a=n("7ec6"),i=n("3b55");for(var s in i)["default"].indexOf(s)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(s);n("a261");var r=n("2877"),c=Object(r["a"])(i["default"],a["render"],a["staticRenderFns"],!1,null,"7bac1d54",null);t["default"]=c.exports},be1b:function(e,t,n){"use strict";n.r(t);var a=n("c3d3"),i=n.n(a);for(var s in a)["default"].indexOf(s)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(s);t["default"]=i.a},c3d3:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={name:"WechatEmpty"};t.default=n},c76b:function(e,t,n){"use strict";n("99cf")},cdbd:function(e,t,n){var a=n("4ea4").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,n("a9e3"),n("d81d"),n("a15b");var i=a(n("e417")),s={name:"TableList",components:{FansLabel:i.default},props:{data:{type:Array,default:function(){return[]}},total:{type:Number,default:0},current:{type:Number,default:1},pageSize:{type:Number,default:10},loading:{type:Boolean,default:!1},tab:{type:String}},data:function(){return{columns:[{type:"selection",width:40,align:"center"},{title:"粉丝名称",slot:"nickname"},{title:"粉丝标签",slot:"fans_label"},{title:"关注状态",slot:"attention_status"},{title:"关注时间",key:"follow_time"},{title:"取关时间",slot:"unfollow_time"},{title:"操作",slot:"action"}],isSelectAll:!1,selectRows:[],checkedId:[],tabList:[]}},computed:{isChecked:function(){return!!this.selectRows.length},noManagePerm:function(){return!this.$getPermMap("channel.wechat.manage")}},methods:{handleRefresh:function(){this.$emit("on-refresh")},changePage:function(e){this.$emit("on-change-page",e)},resetPage:function(){var e;null===(e=this.$refs["page"])||void 0===e||e.reset()},checkboxChange:function(){this.$emit("on-checkbox",this.isSelectAll),this.isSelectAll?this.selectRows=this.data.map((function(e){return e})):this.selectRows=[]},resetChecked:function(){this.isSelectAll=!1,this.selectRows=[]},addLabel:function(e){var t=this,n=e.type,a=void 0===n?"single":n,i=e.row;"single"===a?(this.checkedId=[i.id],this.tabList=(i.tag||[]).map((function(e){return e.id=e.fans_id,e}))):(this.checkedId=this.selectRows.map((function(e){return e.id})),this.tabList=[]),this.$nextTick((function(){t.$refs["fans_label"].setValue()}))},getLabelName:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return null!==e&&void 0!==e&&e.length&&e.map((function(e){return e.tag_name})).join(",")||"-"},selectChange:function(e){this.selectRows=e,this.isSelectAll=this.selectRows.length===this.data.length},setBlack:function(e){var t,n,a=this,i=e.row,s=e.is_black,r=i?[i.id]:this.selectRows.map((function(e){return e.id}));1===s?(t="加入黑名单后，你将无法接收该用户发来的消息，且该用户无法接收公众号发出的消息，无法参与留言和赞赏，确认加入黑名单？",n="加入黑名单成功"):(t="是否移除黑名单",n="移除黑名单成功"),this.$Modal.confirm({title:"提示",content:t,onOk:function(){a.$api.homeApi.setWechatBlackStatus({is_black:s,fans_id:r}).then((function(e){0===e.error&&(a.$Message.success(n),a.handleRefresh())}))}})}}};t.default=s},e417:function(e,t,n){"use strict";n.r(t);var a=n("2bd5"),i=n("1c67");for(var s in i)["default"].indexOf(s)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(s);n("ebf2");var r=n("2877"),c=Object(r["a"])(i["default"],a["render"],a["staticRenderFns"],!1,null,"1577897d",null);t["default"]=c.exports},ebf2:function(e,t,n){"use strict";n("77ef")},ec21:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.staticRenderFns=t.render=void 0,n("ac1f"),n("841c"),n("b0c0");var a=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"fans-list"},[t("kdx-header-bar",{attrs:{type:"little"},scopedSlots:e._u([{key:"header",fn:function(){return[t("div",{staticClass:"header-btn"},[t("Button",{attrs:{type:"primary",disabled:e.noManagePerm},on:{click:e.syncFans}},[e._v("同步所有粉丝")])],1)]},proxy:!0}])},[t("Form",{ref:"form",attrs:{"label-width":100,inline:""},nativeOn:{submit:function(e){e.preventDefault()}}},[t("FormItem",{attrs:{label:"粉丝信息："}},[t("Input",{staticClass:"width-172",attrs:{type:"text",placeholder:"请输入粉丝名称"},on:{"on-enter":e.handleSearch},model:{value:e.search.nickname,callback:function(t){e.$set(e.search,"nickname",t)},expression:"search.nickname"}})],1),t("div",{staticClass:"ivu-form-item-btn"},[t("Button",{attrs:{type:"primary"},on:{click:e.handleSearch}},[e._v("搜索")]),t("Button",{attrs:{type:"text"},on:{click:e.resetSearch}},[e._v("重置")])],1)],1)],1),t("div",{staticClass:"table-content"},[t("ul",{staticClass:"app-content-tab"},e._l(e.tabList,(function(n){return t("li",{key:n.id,class:{active:e.tab===n.id},on:{click:function(t){return e.tabClick(n.id)}}},[e._v(" "+e._s(n.name)+" "),t("div",{staticClass:"active-line"})])})),0),t("div",{staticClass:"sync-time"},[e._v(" 上次同步时间："),t("span",{staticClass:"time"},[e._v(e._s(e.lastSyncTime||"00-00-00 00:00:00"))])]),t("table-list",{ref:"table_list",attrs:{data:e.table.list,total:e.table.total,current:e.page.pageNumber,loading:e.table.loading,"page-size":e.page.pageSize,tab:e.tab},on:{"on-change-page":e.changePage,"on-refresh":e.handleRefresh,"on-checkbox":e.changeCheckbox}})],1),e.isIdentifyService?e._e():t("wechat-empty")],1)};t.render=a;var i=[];t.staticRenderFns=i}}]);