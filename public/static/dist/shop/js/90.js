(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[90],{"05e3":function(e,t,a){"use strict";a.r(t);var n=a("7b2a"),i=a.n(n);for(var r in n)["default"].indexOf(r)<0&&function(e){a.d(t,e,(function(){return n[e]}))}(r);t["default"]=i.a},"147b":function(e,t,a){"use strict";a("bb5c")},2795:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.staticRenderFns=t.render=void 0;var a=function(){var e=this,t=e._self._c;return t("kdx-modal-frame",{attrs:{title:e.id?"编辑类目":"新增类目",width:650,loading:e.loading},on:{"on-cancel":e.handleCancel,"on-ok":e.handleOk},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}},[t("div",{staticClass:"add-goods"},[t("Form",{ref:"form",attrs:{model:e.model,rules:e.rules,"label-width":100},nativeOn:{submit:function(e){e.preventDefault()}}},[t("FormItem",{attrs:{label:"选择分类：",prop:"classify"}},[t("Cascader",{staticClass:"width-340",attrs:{value:e.Cascader,data:e.classifyData,transfer:"",filterable:"",disabled:!!e.id},on:{"on-change":e.changeClassify}}),t("kdx-hint-text",[e._v("选择需要进行类目审核的商品分类")])],1),t("FormItem",{attrs:{label:"营业执照：",prop:"business"}},[t("kdx-image-video",{attrs:{current:e.model.business,width:80,height:80},on:{"on-change":function(t){return e.changeImage(t,"business")}}}),t("kdx-hint-text",[e._v("营业执照或组织机构代码证")])],1),t("FormItem",{attrs:{label:"资质材料：",prop:"certificate"}},[t("kdx-image-video",{attrs:{"current-list":e.model.certificate,multiple:"",limit:50,width:80,height:80},on:{"on-change":function(t){return e.changeImage(t,"certificate")}}}),t("kdx-hint-text",{style:{"margin-top":e.model.certificate.length>=50?"0":"-20px"}},[e._v(e._s(e.certificateHint))])],1)],1)],1)])};t.render=a;var n=[];t.staticRenderFns=n},"2a3d":function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.staticRenderFns=t.render=void 0;var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"table-list"},[t("Table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"tab",attrs:{columns:e.columns,data:e.data},scopedSlots:e._u([{key:"status",fn:function(a){var n=a.row;return[t("kdx-tag-label",{attrs:{type:e.option.status[n.goods_status].type}},[e._v(e._s(e.option.status[n.goods_status].title))])]}},{key:"audit_status",fn:function(a){var n=a.row;return[t("kdx-status-text",{attrs:{type:e.option.auditStatus[n.status].type}},[e._v(e._s(e.option.auditStatus[n.status].title)+" ")])]}},{key:"action",fn:function(a){var n=a.row;return[t("div",{staticClass:"action"},["1"!=n.status?t("Button",{attrs:{type:"text",disabled:e.noManagePerm},on:{click:function(t){return e.handleEdit(n)}}},[e._v("编辑")]):e._e(),"9"==n.status?t("Button",{attrs:{type:"text",disabled:e.noManagePerm},on:{click:function(t){return e.handleDelete(n)}}},[e._v("删除")]):e._e()],1)]}}])}),t("div",{directives:[{name:"show",rawName:"v-show",value:e.total>10,expression:"total > 10"}],staticClass:"footer-page"},[t("kdx-page-component",{ref:"page",attrs:{current:e.current,pageSize:e.pageSize,total:e.total},on:{"on-change":e.changePage}})],1)],1)};t.render=a;var n=[];t.staticRenderFns=n},"2bfb":function(e,t,a){"use strict";var n=a("4b89");a.o(n,"render")&&a.d(t,"render",(function(){return n["render"]})),a.o(n,"staticRenderFns")&&a.d(t,"staticRenderFns",(function(){return n["staticRenderFns"]}))},"2d60":function(e,t,a){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("a9e3");var n={name:"TableList",props:{data:{type:Array,default:function(){return[]}},pageSize:{type:Number,default:10},current:{type:Number,default:1},total:{type:Number,default:0},loading:{type:Boolean,default:!1}},data:function(){return{columns:[{title:"审核单号",key:"audit_id"},{title:"分类名称",key:"category_name"},{title:"审核状态",slot:"audit_status",maxWidth:200},{title:"操作",slot:"action",maxWidth:200}],option:{status:{1:{title:"出售中",type:"success"},2:{title:"已售罄",type:"danger"},3:{title:"仓库中",type:"warning"},4:{title:"回收站",type:"disabled"}},auditStatus:{0:{title:"审核中",type:"warning"},1:{title:"审核成功",type:"success"},9:{title:"审核失败",type:"danger"}}}}},computed:{noManagePerm:function(){return!this.$getPermMap("wxTransactionComponent.category.manage")}},methods:{changePage:function(e){this.$emit("on-page-change",e)},reset:function(e){var t;null===(t=this.$refs["page"])||void 0===t||t.reset(e)},handleEdit:function(e){this.$emit("on-edit",e.id)},recallAudit:function(e){var t=this;this.$api.wxTransactionComponentApi.recallAudit({id:e.id}).then((function(e){0===e.error&&(t.$Message.success("撤销审核成功"),t.$emit("on-refresh"))}))},handleDelete:function(e){var t=this;this.$Modal.confirm({title:"提示",content:"确认删除？",onOk:function(){t.$api.wxTransactionComponentApi.deleteCategoryAudit({id:e.id}).then((function(e){0===e.error&&(t.$Message.success("商品删除成功"),t.$emit("on-refresh"))}))}})}}};t.default=n},"3b0d":function(e,t,a){"use strict";a.r(t);var n=a("94e48"),i=a("a440");for(var r in i)["default"].indexOf(r)<0&&function(e){a.d(t,e,(function(){return i[e]}))}(r);a("7f99");var s=a("2877"),o=Object(s["a"])(i["default"],n["render"],n["staticRenderFns"],!1,null,"10d239bc",null);t["default"]=o.exports},"4b89":function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.staticRenderFns=t.render=void 0;var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"wx-transaction"},[t("kdx-header-bar",{attrs:{type:"little"},scopedSlots:e._u([{key:"header",fn:function(){return[t("div",{staticClass:"header-btn"},[t("Button",{staticClass:"marginR-10",attrs:{type:"primary",disabled:e.noManagePerm},on:{click:function(t){return e.handleAction("add")}}},[e._v("+新增类目")]),t("Button",{staticClass:"primary-border",attrs:{disabled:e.noManagePerm},on:{click:function(t){return e.handleAction("refresh")}}},[e._v("同步刷新")])],1)]},proxy:!0}])}),t("table-list",{ref:"table",attrs:{data:e.tableData,"page-size":e.page.pageSize,current:e.page.pageNumber,total:e.total,loading:e.loading},on:{"on-page-change":e.changePage,"on-refresh":e.handleRefresh,"on-edit":e.handleEdit}}),t("add-category",{ref:"add_category",attrs:{id:e.categoryId},on:{"on-refresh":e.handleRefresh}}),e._t("default")],2)};t.render=a;var n=[];t.staticRenderFns=n},"59c7":function(e,t,a){"use strict";a.r(t);var n=a("2bfb"),i=a("05e3");for(var r in i)["default"].indexOf(r)<0&&function(e){a.d(t,e,(function(){return i[e]}))}(r);a("ffe4");var s=a("2877"),o=Object(s["a"])(i["default"],n["render"],n["staticRenderFns"],!1,null,"468e16fc",null);t["default"]=o.exports},6430:function(e,t,a){},6810:function(e,t,a){},"7b2a":function(e,t,a){var n=a("4ea4").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(a("5530"));a("ac1f"),a("841c"),a("d3b7");var r=n(a("3b0d")),s=n(a("b19a")),o={name:"index",components:{TableList:r.default,AddCategory:s.default},data:function(){return{search:{},tableData:[],page:{pageSize:10,pageNumber:1},total:0,loading:!1,categoryId:""}},computed:{noManagePerm:function(){return!this.$getPermMap("wxTransactionComponent.category.manage")}},created:function(){this.handleRefresh()},methods:{handleSearch:function(e){this.search=e,this.handleRefresh()},changePage:function(e){this.page=e,this.getData()},getData:function(){var e=this;this.loading=!0;var t=(0,i.default)({pagesize:this.page.pageSize,page:this.page.pageNumber},this.search);this.$api.wxTransactionComponentApi.getCategoryList(t).then((function(t){0===t.error&&(e.tableData=t.data.list,e.total=t.data.total)})).finally((function(){e.loading=!1}))},handleRefresh:function(){this.resetPage(),this.getData()},handleAction:function(e){if(!this.noManagePerm)switch(e){case"add":this.categoryId="",this.$refs["add_category"].setValue();break;case"refresh":this.syncRefresh();break}},resetPage:function(){var e;this.page={pageSize:10,pageNumber:1},null===(e=this.$refs["table"])||void 0===e||e.reset()},syncRefresh:function(){var e=this;this.loading=!0;var t={page_size:this.page.pageSize,page:this.page.pageNumber};this.$api.wxTransactionComponentApi.updateCategoryAuditStatus(t).then((function(t){0===t.error&&e.getData()})).finally((function(){e.loading=!1}))},handleEdit:function(e){var t=this;this.categoryId=e,this.$nextTick((function(){t.$refs["add_category"].setValue()}))}}};t.default=o},"7f99":function(e,t,a){"use strict";a("6430")},"937d":function(e,t,a){var n=a("4ea4").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(a("b85c")),r=n(a("c7eb")),s=n(a("1da1"));a("a9e3"),a("d3b7"),a("d81d"),a("14d9"),a("4de4"),a("159b");var o={name:"AddGoods",props:{id:{type:[Number,String]}},data:function(){return{value:!1,model:{classify:"",business:"",certificate:[]},Cascader:[],rules:{classify:[{required:!0,message:"分类必填"}],business:[{required:!0,message:"营业执照必填"}],certificate:[{required:!0,message:"资质材料必填"}]},loading:!1,classifyData:[],certificateHint:"",business:[],certificate:[]}},methods:{setValue:function(){var e=this;return(0,s.default)((0,r.default)().mark((function t(){return(0,r.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.value=!e.value,!e.value){t.next=11;break}return e.loading=!0,e.resetModel(),t.next=6,e.getCategory();case 6:if(t.t0=e.id,!t.t0){t.next=10;break}return t.next=10,e.getDetail();case 10:e.loading=!1;case 11:case"end":return t.stop()}}),t)})))()},getCategory:function(){var e=this;return new Promise((function(t){e.$api.wxTransactionComponentApi.getCategory({sign:!0}).then((function(t){0===t.error&&(e.classifyData=t.data||[])})).finally((function(){t()}))}))},getDetail:function(){var e=this;return new Promise((function(t){e.$api.wxTransactionComponentApi.getCategoryAuditDetail({id:e.id}).then((function(t){var a,n,i,r;0===t.error&&(e.getCascader(t.data.category_id,e.classifyData),e.business=(null===(a=t.data.path)||void 0===a?void 0:a.license)||[],e.certificate=(null===(n=t.data.path)||void 0===n?void 0:n.certificate)||[],e.model={classify:t.data.category_id,business:(null===(i=e.business)||void 0===i||null===(r=i[0])||void 0===r?void 0:r.path)||"",certificate:e.certificate.map((function(e){return e.path}))})})).finally((function(){t()}))}))},getCascader:function(e,t){var a,n=[],r=(0,i.default)(t);try{for(r.s();!(a=r.n()).done;){var s,o=a.value;if(n=[o.value],null!==(s=o.children)&&void 0!==s&&s.length){var d,c=(0,i.default)(o.children);try{for(c.s();!(d=c.n()).done;){var u=d.value;if(n=[n[0],u.value],u.children){var l,f=(0,i.default)(u.children);try{for(f.s();!(l=f.n()).done;){var h=l.value;h.value===e&&(n.push(h.value),this.Cascader=n)}}catch(m){f.e(m)}finally{f.f()}}}}catch(m){c.e(m)}finally{c.f()}}}}catch(m){r.e(m)}finally{r.f()}var g,v=(0,i.default)(t);try{for(v.s();!(g=v.n()).done;){var p=g.value;if(p.value===this.Cascader[0]){this.certificateHint=p.qualification;break}}}catch(m){v.e(m)}finally{v.f()}},handleOk:function(){var e=this;this.$refs["form"].validate((function(t){if(t){e.loading=!0;var a={cat_id:e.model.classify,path:{license:e.getPathParams(e.business,[e.model.business]),certificate:e.getPathParams(e.certificate,e.model.certificate)}};e.id&&(a.id=e.id),console.log("params",a,e.model.certificate),e.$api.wxTransactionComponentApi.addCategoryAudit(a).then((function(t){if(0===t.error){var a=e.id?"类目编辑成功":"类目添加审核成功";e.$Message.success(a),e.setValue(),e.$emit("on-refresh")}})).finally((function(){e.loading=!1}))}}))},getPathParams:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return t.map((function(t){var a=e.filter((function(e){return e.path===t}));return a.length>0?a[0]:{path:t}}))},handleCancel:function(){this.setValue()},changeClassify:function(e,t){var a;null!==(a=t)&&void 0!==a&&a.length?this.certificateHint=t[0].qualification:t=this.getSelectClassify(e,this.classifyData);var n=t[t.length-1];this.model.classify=n.value,this.Cascader=e.map((function(e){return parseInt(e)}))},getSelectClassify:function(e,t){var a=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return t.forEach((function(t){var i;t.value===+e[(null===n||void 0===n?void 0:n.length)||0]&&(n.push(t),(null===(i=t.children)||void 0===i?void 0:i.length)&&a.getSelectClassify(e,t.children,n),t.qualification&&(a.certificateHint=t.qualification))})),n},resetModel:function(){this.$refs["form"].resetFields(),console.log("model",this.model),this.Cascader=[],this.certificateHint=""},changeImage:function(e,t){this.model[t]=e}}};t.default=o},"94e48":function(e,t,a){"use strict";var n=a("2a3d");a.o(n,"render")&&a.d(t,"render",(function(){return n["render"]})),a.o(n,"staticRenderFns")&&a.d(t,"staticRenderFns",(function(){return n["staticRenderFns"]}))},a440:function(e,t,a){"use strict";a.r(t);var n=a("2d60"),i=a.n(n);for(var r in n)["default"].indexOf(r)<0&&function(e){a.d(t,e,(function(){return n[e]}))}(r);t["default"]=i.a},b19a:function(e,t,a){"use strict";a.r(t);var n=a("f387"),i=a("e331");for(var r in i)["default"].indexOf(r)<0&&function(e){a.d(t,e,(function(){return i[e]}))}(r);a("147b");var s=a("2877"),o=Object(s["a"])(i["default"],n["render"],n["staticRenderFns"],!1,null,"4a226eb0",null);t["default"]=o.exports},bb5c:function(e,t,a){},e331:function(e,t,a){"use strict";a.r(t);var n=a("937d"),i=a.n(n);for(var r in n)["default"].indexOf(r)<0&&function(e){a.d(t,e,(function(){return n[e]}))}(r);t["default"]=i.a},f387:function(e,t,a){"use strict";var n=a("2795");a.o(n,"render")&&a.d(t,"render",(function(){return n["render"]})),a.o(n,"staticRenderFns")&&a.d(t,"staticRenderFns",(function(){return n["staticRenderFns"]}))},ffe4:function(e,t,a){"use strict";a("6810")}}]);