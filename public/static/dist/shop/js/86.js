(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[86],{"011e":function(e,t,n){"use strict";var r=n("37d6");n.o(r,"render")&&n.d(t,"render",(function(){return r["render"]})),n.o(r,"staticRenderFns")&&n.d(t,"staticRenderFns",(function(){return r["staticRenderFns"]}))},1538:function(e,t,n){},"156b":function(e,t,n){"use strict";n.r(t);var r=n("7010"),a=n.n(r);for(var o in r)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(o);t["default"]=a.a},"336c":function(e,t,n){"use strict";n.r(t);var r=n("bef1"),a=n.n(r);for(var o in r)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(o);t["default"]=a.a},"357a":function(e,t,n){"use strict";n("5ac2")},"37d6":function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.staticRenderFns=t.render=void 0;var n=function(){var e=this,t=e._self._c;return t("kdx-modal-frame",{attrs:{title:"文字回复",value:e.value},on:{"on-cancel":e.cancelHandler},scopedSlots:e._u([{key:"footer",fn:function(){return[t("div",[t("Button",{staticClass:"default-long",on:{click:e.cancelHandler}},[e._v("取消")]),t("Button",{staticClass:"primary-long",on:{click:e.validate}},[e._v("确认")])],1)]},proxy:!0}])},[t("div",{staticClass:"content"},[t("Form",{ref:"form",attrs:{model:e.model,"label-width":120,rules:e.rules}},[t("FormItem",{staticClass:"mb-20",attrs:{label:"文字回复：",prop:"content"}},[t("Input",{staticClass:"width-340",model:{value:e.model.content,callback:function(t){e.$set(e.model,"content",t)},expression:"model.content"}})],1)],1)],1)])};t.render=n;var r=[];t.staticRenderFns=r},"3d33":function(e,t,n){var r=n("4ea4").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n("5530")),o={props:{current:{type:Object,default:function(){}}},data:function(){return{model:{keyword:"",type:"2"},rules:{keyword:[{required:!0,message:"请填写关键词",trigger:"blur"}]},value:!1}},methods:{setValue:function(){this.value=!this.value,this.value&&this.init()},init:function(){var e=this;this.$nextTick((function(){e.current.keyword?e.model=(0,a.default)((0,a.default)({},e.model),e.current):e.model={keyword:"",type:"2"}}))},cancelHandler:function(){this.setValue()},validate:function(){var e=this;this.$refs.form.validate((function(t){t&&e.saveHandler()}))},saveHandler:function(){this.$emit("on-change",(0,a.default)({},this.model)),this.$refs.form.resetFields(),this.cancelHandler()}}};t.default=o},5691:function(e,t,n){"use strict";n.r(t);var r=n("011e"),a=n("156b");for(var o in a)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(o);n("357a");var i=n("2877"),d=Object(i["a"])(a["default"],r["render"],r["staticRenderFns"],!1,null,"6182e24c",null);t["default"]=d.exports},"57f8":function(e,t,n){"use strict";n("a923")},"5ac2":function(e,t,n){},"6e2c":function(e,t,n){"use strict";n.r(t);var r=n("c59c0"),a=n("cdd3");for(var o in a)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(o);n("b7fa");var i=n("2877"),d=Object(i["a"])(a["default"],r["render"],r["staticRenderFns"],!1,null,"1b30e5b0",null);t["default"]=d.exports},7010:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={props:{current:{type:String,default:""}},data:function(){return{model:{content:""},rules:{content:[{required:!0,message:"请填写文字回复",trigger:"blur"}]},value:!1}},methods:{setValue:function(){this.value=!this.value,this.value&&this.init()},init:function(){var e=this;this.$nextTick((function(){e.current?e.model.content=e.current:e.model={content:""}}))},cancelHandler:function(){this.setValue()},validate:function(){var e=this;this.$refs.form.validate((function(t){t&&e.saveHandler()}))},saveHandler:function(){this.$emit("on-change",this.model.content),this.$refs.form.resetFields(),this.cancelHandler()}}};t.default=n},"934e":function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.staticRenderFns=t.render=void 0;var n=function(){var e=this,t=e._self._c;return t("kdx-modal-frame",{attrs:{title:"关键词",value:e.value},on:{"on-cancel":e.cancelHandler},scopedSlots:e._u([{key:"footer",fn:function(){return[t("div",[t("Button",{staticClass:"default-long",on:{click:e.cancelHandler}},[e._v("取消")]),t("Button",{staticClass:"primary-long",on:{click:e.validate}},[e._v("确认")])],1)]},proxy:!0}])},[t("div",{staticClass:"content"},[t("Form",{ref:"form",attrs:{model:e.model,"label-width":120,rules:e.rules}},[t("FormItem",{staticClass:"mb-20",attrs:{label:"关键词：",prop:"keyword"}},[t("Input",{staticClass:"width-340",model:{value:e.model.keyword,callback:function(t){e.$set(e.model,"keyword",t)},expression:"model.keyword"}})],1),t("FormItem",{staticClass:"mb-20",attrs:{label:"匹配规则："}},[t("RadioGroup",{model:{value:e.model.type,callback:function(t){e.$set(e.model,"type",t)},expression:"model.type"}},[t("Radio",{attrs:{label:"2"}},[e._v("模糊匹配")]),t("Radio",{attrs:{label:"1"}},[e._v("精准匹配")])],1)],1)],1)],1)])};t.render=n;var r=[];t.staticRenderFns=r},a022:function(e,t,n){"use strict";var r=n("c728");n.o(r,"render")&&n.d(t,"render",(function(){return r["render"]})),n.o(r,"staticRenderFns")&&n.d(t,"staticRenderFns",(function(){return r["staticRenderFns"]}))},a923:function(e,t,n){},b7fa:function(e,t,n){"use strict";n("1538")},bef1:function(e,t,n){var r=n("4ea4").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,n("d3b7"),n("159b"),n("6062"),n("3ca3"),n("ddb0"),n("d81d"),n("14d9"),n("a434");var a=r(n("2909")),o=r(n("5530")),i=r(n("15fd")),d=r(n("7177")),l=r(n("6e2c")),c=r(n("5691")),s=["rule_content"],u={components:{KeyWordModal:l.default,TextModal:c.default,ImageSelector:d.default},data:function(){var e=this,t=this.$createElement;return{model:{name:"",containtype:[],rule_keyword_data:[],reply_setting:"1",rule_content:[],module:"wechat"},rules:{name:[{required:!0,message:"请输入规则名称"}],rule_content:[{required:!0,message:"请设置回复内容",type:"array"}],rule_keyword_data:[{required:!0,message:"请设置关键字",type:"array"}]},columns:[{width:60,title:" ",render:function(){return t("i",{class:"iconfont icon-move move-icon"})}},{title:"回复内容",key:"content",render:function(t,n){var r=n.row;return"images"==r.containtype?t("img",{class:"reply-img",attrs:{src:e.$media(r.content.path)},on:{error:function(t){e.replaceImage(t)}}}):t("div",[r.content])}},{title:"操作",width:100,render:function(t,n){var r=n.index;return t("div",[t("Button",{attrs:{type:"text"},on:{click:function(){return e.handleContentEdit(r)}}},["编辑"]),t("Button",{attrs:{type:"text"},class:"btn-next",on:{click:function(){return e.handleRemoveContent(r)}}},["删除"])])}}],loading:!1,keyColumns:[{title:"关键词",key:"keyword"},{title:"匹配",key:"type",render:function(e,t){var n=t.row;return"1"==n.type?e("div",{class:"match_tag strict"},["精准匹配"]):e("div",{class:"match_tag vague"},["模糊匹配"])}},{title:"操作",width:100,render:function(t,n){var r=n.index;return t("div",[t("Button",{attrs:{type:"text"},on:{click:function(){return e.handleEdit(r)}}},["编辑"]),t("Button",{attrs:{type:"text"},class:"btn-next",on:{click:function(){return e.handleRemove(r)}}},["删除"])])}}],keyIndex:-1,contentIndex:-1}},computed:{currentKey:function(){return this.keyIndex>-1?this.model.rule_keyword_data[this.keyIndex]:{}},currentContent:function(){return this.contentIndex>-1?this.model.rule_content[this.contentIndex].content:""},noManagePerm:function(){return!this.$getPermMap("channel.wechat.manage")}},created:function(){var e=this.$route.query.id;e&&(this.model.id=e,this.getKeyInfo(e))},methods:{getKeyInfo:function(e){var t=this;this.$api.homeApi.getKeyWord({id:e}).then((function(e){if(0===e.error){var n=e.data,r=n.rule_content,a=(0,i.default)(n,s);r.forEach((function(e){if("images"===e.containtype){var t,n=(null===(t=e.content)||void 0===t?void 0:t.split("_id="))||[];e.content={id:(null===n||void 0===n?void 0:n[1])||"",path:(null===n||void 0===n?void 0:n[0])||""}}})),t.model=(0,o.default)((0,o.default)((0,o.default)({},t.model),a),{},{rule_content:r})}}))},validate:function(){var e=this;this.$refs.form.validate((function(t){t&&e.submitSave()}))},submitSave:function(){var e=this;this.model.containtype=(0,a.default)(new Set(this.model.rule_content.map((function(e){return e.containtype}))));var t=this.model.id?"updateKeyWord":"addKeyWord",n=new Set,r=[];this.model.rule_content.forEach((function(e){var t={};t="images"===e.containtype?{containtype:e.containtype,content:e.content.path+"_id="+e.content.id,attachment_id:e.content.id}:{containtype:e.containtype,content:e.content},e.id&&(t.id=e.id),n.add(e.containtype),r.push(t)}));var i=(0,o.default)((0,o.default)({},this.model),{},{containtype:(0,a.default)(n),rule_content:r});this.loading=!0,this.$api.homeApi[t](i).then((function(t){0==t.error&&(e.$Message.success("保存成功"),e.$router.back())})).finally((function(){e.loading=!1}))},addKeyword:function(){this.keyIndex=-1,this.$refs.keyModal.setValue()},keywordChange:function(e){var t=this;-1==this.keyIndex||e.keyword!=this.model.rule_keyword_data[this.keyIndex].keyword?this.$api.homeApi.checkKeyWord({keyword:e.keyword}).then((function(n){0===n.error&&(-1==t.keyIndex?t.model.rule_keyword_data.push(e):t.$set(t.model.rule_keyword_data,t.keyIndex,e))})):this.$set(this.model.rule_keyword_data,this.keyIndex,e)},handleEdit:function(e){this.keyIndex=e,this.$refs.keyModal.setValue()},handleRemove:function(e){this.model.rule_keyword_data.splice(e,1)},addText:function(){this.contentIndex=-1,this.$refs.textModal.setValue()},addImage:function(){this.contentIndex=-1,this.$refs.imgModal.setValue()},handleContentEdit:function(e){this.contentIndex=e,"images"==this.model.rule_content[e].containtype?this.$refs.imgModal.setValue():this.$refs.textModal.setValue()},handleRemoveContent:function(e){this.model.rule_content.splice(e,1)},textChange:function(e){-1==this.contentIndex?this.model.rule_content.push({containtype:"text",content:e}):this.$set(this.model.rule_content[this.contentIndex],"content",e)},imgChange:function(e){-1==this.contentIndex?this.model.rule_content.push({containtype:"images",content:e}):e&&this.$set(this.model.rule_content[this.contentIndex],"content",e)},draggeTable:function(e,t){var n=this.model.rule_content,r=(0,o.default)({},n[e]);Object.assign(n[e],n[t]),Object.assign(n[t],r)}}};t.default=u},c59c0:function(e,t,n){"use strict";var r=n("934e");n.o(r,"render")&&n.d(t,"render",(function(){return r["render"]})),n.o(r,"staticRenderFns")&&n.d(t,"staticRenderFns",(function(){return r["staticRenderFns"]}))},c728:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.staticRenderFns=t.render=void 0,n("b0c0");var r=function(){var e=this,t=e._self._c;return t("kdx-content-bar",{scopedSlots:e._u([{key:"btn",fn:function(){return[t("Button",{staticClass:"primary-long",attrs:{disabled:e.noManagePerm,loading:e.loading,type:"primary"},on:{click:e.validate}},[e._v("保存")])]},proxy:!0}])},[t("div",{staticClass:"content"},[t("Form",{ref:"form",attrs:{model:e.model,rules:e.rules,"label-width":150}},[t("kdx-form-title",[e._v("基本信息")]),t("FormItem",{attrs:{label:"规则名称：",prop:"name"}},[t("Input",{staticClass:"width-340",attrs:{placeholder:"请输入规则名称"},model:{value:e.model.name,callback:function(t){e.$set(e.model,"name",t)},expression:"model.name"}})],1),t("FormItem",{attrs:{label:"关键词设置：",prop:"rule_keyword_data"}},[t("Button",{attrs:{type:"primary"},on:{click:e.addKeyword}},[e._v("+添加关键词")]),t("div",{staticClass:"table"},[t("Table",{attrs:{draggable:"",border:"",columns:e.keyColumns,data:e.model.rule_keyword_data,size:"small"},on:{"on-drag-drop":e.draggeTable}})],1)],1),t("kdx-form-title",[e._v("回复内容")]),t("FormItem",{attrs:{label:"规则名称："}},[t("RadioGroup",{model:{value:e.model.reply_setting,callback:function(t){e.$set(e.model,"reply_setting",t)},expression:"model.reply_setting"}},[t("Radio",{attrs:{label:"1"}},[e._v("回复首条")]),t("Radio",{attrs:{label:"2"}},[e._v("随机回复一条")]),t("Radio",{attrs:{label:"3"}},[e._v("回复全部")])],1)],1),t("FormItem",{attrs:{label:"添加回复内容：",prop:"rule_content"}},[t("Button",{attrs:{type:"primary"},on:{click:e.addText}},[e._v("+添加文字")]),t("Button",{staticClass:"btn-next",attrs:{type:"primary"},on:{click:e.addImage}},[e._v("+添加图片")]),t("div",{staticClass:"table"},[t("Table",{attrs:{draggable:"",border:"",columns:e.columns,data:e.model.rule_content,size:"small"},on:{"on-drag-drop":e.draggeTable}})],1)],1)],1)],1),t("key-word-modal",{ref:"keyModal",attrs:{current:e.currentKey},on:{"on-change":e.keywordChange}}),t("text-modal",{ref:"textModal",attrs:{current:e.currentContent},on:{"on-change":e.textChange}}),t("image-selector",{ref:"imgModal",attrs:{current:e.currentContent,"return-type":"object"},on:{"on-change":e.imgChange}})],1)};t.render=r;var a=[];t.staticRenderFns=a},cdd3:function(e,t,n){"use strict";n.r(t);var r=n("3d33"),a=n.n(r);for(var o in r)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(o);t["default"]=a.a},d07f:function(e,t,n){"use strict";n.r(t);var r=n("a022"),a=n("336c");for(var o in a)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(o);n("57f8");var i=n("2877"),d=Object(i["a"])(a["default"],r["render"],r["staticRenderFns"],!1,null,"6ce9cfa4",null);t["default"]=d.exports}}]);