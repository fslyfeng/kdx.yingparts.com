(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[68],{"22a4":function(e,t,a){"use strict";a("cc93")},"2b4f":function(e,t,a){"use strict";var n=a("d2d7");a.o(n,"render")&&a.d(t,"render",(function(){return n["render"]})),a.o(n,"staticRenderFns")&&a.d(t,"staticRenderFns",(function(){return n["staticRenderFns"]}))},"2fea":function(e,t,a){"use strict";var n=a("5fd0");a.o(n,"render")&&a.d(t,"render",(function(){return n["render"]})),a.o(n,"staticRenderFns")&&a.d(t,"staticRenderFns",(function(){return n["staticRenderFns"]}))},"441c":function(e,t,a){"use strict";a.r(t);var n=a("c62e"),i=a("9417");for(var r in i)["default"].indexOf(r)<0&&function(e){a.d(t,e,(function(){return i[e]}))}(r);a("cda3");var s=a("2877"),o=Object(s["a"])(i["default"],n["render"],n["staticRenderFns"],!1,null,"28abd76c",null);t["default"]=o.exports},"4ac3":function(e,t,a){Object.defineProperty(t,"__esModule",{value:!0}),t.staticRenderFns=t.render=void 0;var n=function(){var e=this;e._self._c;return e._m(0)};t.render=n;var i=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"wechat-empty"},[t("div",{staticClass:"empty-img"},[t("img",{attrs:{src:a("7677"),alt:""}}),t("div",{staticClass:"text"},[e._v(" 您的公众号类型为未认证服务号，暂不支持本功能 ")])])])}];t.staticRenderFns=i},"4d66":function(e,t,a){"use strict";a.r(t);var n=a("669c"),i=a.n(n);for(var r in n)["default"].indexOf(r)<0&&function(e){a.d(t,e,(function(){return n[e]}))}(r);t["default"]=i.a},"5fd0":function(e,t,a){Object.defineProperty(t,"__esModule",{value:!0}),t.staticRenderFns=t.render=void 0,a("ac1f"),a("841c"),a("b0c0");var n=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"fans-label"},[t("kdx-header-bar",{attrs:{type:"little"},scopedSlots:e._u([{key:"header",fn:function(){return[t("div",{staticClass:"header-btn"},[t("Button",{attrs:{disabled:e.noManagePerm,type:"primary"},on:{click:e.createFans}},[e._v("+创建粉丝标签")]),t("Button",{staticClass:"primary-border marginL-10",attrs:{disabled:e.noManagePerm},on:{click:e.syncFans}},[e._v("同步粉丝标签")])],1)]},proxy:!0}])},[t("Form",{ref:"form",attrs:{"label-width":100,inline:""},nativeOn:{submit:function(e){e.preventDefault()}}},[t("FormItem",{attrs:{label:"标签名称："}},[t("Input",{staticClass:"width-172",attrs:{type:"text",placeholder:"请输入标签名称"},on:{"on-enter":e.handleSearch},model:{value:e.search.tag_name,callback:function(t){e.$set(e.search,"tag_name",t)},expression:"search.tag_name"}})],1),t("div",{staticClass:"ivu-form-item-btn"},[t("Button",{attrs:{type:"primary"},on:{click:e.handleSearch}},[e._v("搜索")]),t("Button",{attrs:{type:"text"},on:{click:e.resetSearch}},[e._v("重置")])],1)],1)],1),t("table-list",{ref:"table_list",attrs:{data:e.table.data,total:e.table.total,current:e.page.pageNumber,"page-size":e.page.pageSize,loading:e.table.loading,"last-sync-time":e.lastSyncTime},on:{"on-action":e.handleTableAction,"on-change-page":e.changePage}}),t("label-modal",{ref:"label_modal",attrs:{id:e.table.id,name:e.table.name},on:{"on-refresh":e.handleRefresh}}),e.isIdentifyService?e._e():t("wechat-empty")],1)};t.render=n;var i=[];t.staticRenderFns=i},"669c":function(e,t,a){var n=a("4ea4").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("ac1f"),a("841c"),a("d3b7"),a("b0c0");var i=n(a("5530")),r=n(a("441c")),s=n(a("a90b")),o=n(a("903f")),c={name:"index",components:{TableList:r.default,LabelModal:s.default,WechatEmpty:o.default},data:function(){return{search:{tag_name:""},table:{data:[],total:0,loading:!1,id:"",name:""},page:{pageSize:10,pageNumber:1},isIdentifyService:!1,loading:!1,lastSyncTime:""}},created:function(){var e=this;this.$store.dispatch("channel/getWechatInfo").then((function(t){var a=t.isIdentifyService;e.isIdentifyService=a,a&&e.getList()}))},computed:{noManagePerm:function(){return!this.$getPermMap("channel.wechat.manage")}},methods:{getList:function(){var e=this;this.table.loading=!0;var t=(0,i.default)({pagesize:this.page.pageSize,page:this.page.pageNumber},this.search);this.$api.homeApi.getWechatFansLabelList(t).then((function(t){0===t.error&&(e.table.data=t.list||[],e.table.total=t.total||0,e.lastSyncTime=t.last_sync_time||"")})).finally((function(){e.table.loading=!1}))},createFans:function(){var e=this;this.table.id="",this.table.name="",this.$nextTick((function(){e.$refs["label_modal"].setValue()}))},syncFans:function(){var e=this;this.loading=!0,this.$api.homeApi.syncWechatFansLabel().then((function(t){0===t.error?e.getTaskInfo(t.task_id):e.loading=!1}))},getTaskInfo:function(e){var t=this;this.$api.homeApi.getTaskInfo({task_id:e}).then((function(a){if(0===a.error){var n,i,r;if(0===+(null===(n=a.data)||void 0===n?void 0:n.status))return void setTimeout((function(){t.getTaskInfo(e)}),3e3);if(1===+(null===(i=a.data)||void 0===i?void 0:i.status))return t.$Message.success("同步成功"),t.loading=!1,void t.handleRefresh();if(2===+(null===(r=a.data)||void 0===r?void 0:r.status))return void t.$Message.error("同步失败")}t.loading=!1}))},handleSearch:function(){this.handleRefresh()},resetSearch:function(){this.search={tag_name:""},this.handleRefresh()},handleRefresh:function(){this.resetPage(),this.getList()},handleTableAction:function(e,t){var a=this;switch(t){case"edit":this.table.name=e.tag_name,this.table.id=e.wechat_tag_id,this.$nextTick((function(){a.$refs["label_modal"].setValue()}));break;case"delete":this.deleteLabel(e);break}},deleteLabel:function(e){var t=this;console.log("delete",e),this.$api.homeApi.deleteWechatFansLabel({wechat_tag_id:e.wechat_tag_id}).then((function(e){0===e.error&&(t.$Message.success("粉丝标签删除成功"),t.handleRefresh())}))},resetPage:function(){this.page={pageSize:10,pageNumber:1},this.$refs["table_list"].resetPage()},changePage:function(e){this.page=e,this.getList()}}};t.default=c},"6fdd":function(e,t,a){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("a9e3");var n={name:"TableList",props:{data:{type:Array,default:function(){return[]}},total:{type:Number,default:0},current:{type:Number,default:1},pageSize:{type:Number,default:10},loading:{type:Boolean,default:!1},lastSyncTime:{type:String}},data:function(){return{columns:[{title:"标签名称",key:"tag_name"},{title:"粉丝数量",key:"fans_num"},{title:"操作",slot:"action"}]}},computed:{noManagePerm:function(){return!this.$getPermMap("channel.wechat.manage")}},methods:{editName:function(e){this.$emit("on-action",e,"edit")},deleteLabel:function(e){var t=this;this.$Modal.confirm({title:"提示",content:"删除标签后，该标签下的所有用户将失去该标签属性。是否确定删除？",onOk:function(){t.$emit("on-action",e,"delete")}})},changePage:function(e){this.$emit("on-change-page",e)},resetPage:function(){this.$refs["page"].reset()}}};t.default=n},"70e3":function(e,t,a){function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=e.replace(/[\u0391-\uFFE5]/g,"xx");return a.length>t}Object.defineProperty(t,"__esModule",{value:!0}),t.validCharLen=n,a("ac1f"),a("5319")},7677:function(e,t,a){e.exports=a.p+"static/dist/shop/img/wechat-no-type.png"},"78cd":function(e,t,a){"use strict";a("7bc1")},"7bc1":function(e,t,a){},"7f01":function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.staticRenderFns=t.render=void 0;var a=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"table-list"},[t("div",{staticClass:"sync-time"},[e._v(" 上次同步时间："),t("span",{staticClass:"time"},[e._v(e._s(e.lastSyncTime||"00-00-00 00:00:00"))])]),t("Table",{ref:"table",attrs:{columns:e.columns,data:e.data},scopedSlots:e._u([{key:"action",fn:function(a){var n=a.row;return[t("Button",{attrs:{disabled:e.noManagePerm,type:"text"},on:{click:function(t){return e.editName(n)}}},[e._v("修改名称")]),t("Button",{staticClass:"marginL-10",attrs:{disabled:e.noManagePerm,type:"text"},on:{click:function(t){return e.deleteLabel(n)}}},[e._v("删除")])]}}])}),t("div",{directives:[{name:"show",rawName:"v-show",value:e.total>10,expression:"total > 10"}],staticClass:"footer-page"},[t("kdx-page-component",{ref:"page",attrs:{current:e.current,pageSize:e.pageSize,total:e.total},on:{"on-change":e.changePage}})],1)],1)};t.render=a;var n=[];t.staticRenderFns=n},"903f":function(e,t,a){"use strict";a.r(t);var n=a("9d65"),i=a("be1b");for(var r in i)["default"].indexOf(r)<0&&function(e){a.d(t,e,(function(){return i[e]}))}(r);a("c76b");var s=a("2877"),o=Object(s["a"])(i["default"],n["render"],n["staticRenderFns"],!1,null,"29b9512d",null);t["default"]=o.exports},9417:function(e,t,a){"use strict";a.r(t);var n=a("6fdd"),i=a.n(n);for(var r in n)["default"].indexOf(r)<0&&function(e){a.d(t,e,(function(){return n[e]}))}(r);t["default"]=i.a},"99cf":function(e,t,a){},"9d65":function(e,t,a){"use strict";var n=a("4ac3");a.o(n,"render")&&a.d(t,"render",(function(){return n["render"]})),a.o(n,"staticRenderFns")&&a.d(t,"staticRenderFns",(function(){return n["staticRenderFns"]}))},a0da:function(e,t,a){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("a9e3"),a("d9e2"),a("b0c0"),a("d3b7");var n=a("70e3"),i={name:"LabelModal",props:{id:{type:[Number,String]},name:{type:[String]}},data:function(){return{value:!1,model:{name:""},rules:{name:[{required:!0,message:"标签名称必填"},{validator:function(e,t,a){(0,n.validCharLen)(t,12)?a(new Error("不得超过6个汉字或12个字符")):a()}}]},loading:!1}},methods:{setValue:function(){this.value=!this.value,this.value&&(this.$refs["form"].resetFields(),this.model.name=this.id&&this.name||"")},handleOk:function(){var e=this;this.$refs["form"].validate((function(t){if(t){console.log("valid",t);var a={name:e.model.name};e.id?(a.wechat_tag_id=e.id,e.saveLabel(a)):e.saveLabel(a)}}))},saveLabel:function(e){var t=this;this.loading=!0,this.$api.homeApi.createWechatFansLabel(e).then((function(e){0===e.error&&(t.id?t.$Message.success("标签编辑成功"):t.$Message.success("标签添加成功"),t.setValue(),t.$emit("on-refresh"))})).finally((function(){t.loading=!1}))}}};t.default=i},a90b:function(e,t,a){"use strict";a.r(t);var n=a("2b4f"),i=a("be33");for(var r in i)["default"].indexOf(r)<0&&function(e){a.d(t,e,(function(){return i[e]}))}(r);a("78cd");var s=a("2877"),o=Object(s["a"])(i["default"],n["render"],n["staticRenderFns"],!1,null,"719eab80",null);t["default"]=o.exports},ac7e:function(e,t,a){},be1b:function(e,t,a){"use strict";a.r(t);var n=a("c3d3"),i=a.n(n);for(var r in n)["default"].indexOf(r)<0&&function(e){a.d(t,e,(function(){return n[e]}))}(r);t["default"]=i.a},be33:function(e,t,a){"use strict";a.r(t);var n=a("a0da"),i=a.n(n);for(var r in n)["default"].indexOf(r)<0&&function(e){a.d(t,e,(function(){return n[e]}))}(r);t["default"]=i.a},c3d3:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a={name:"WechatEmpty"};t.default=a},c62e:function(e,t,a){"use strict";var n=a("7f01");a.o(n,"render")&&a.d(t,"render",(function(){return n["render"]})),a.o(n,"staticRenderFns")&&a.d(t,"staticRenderFns",(function(){return n["staticRenderFns"]}))},c76b:function(e,t,a){"use strict";a("99cf")},cc93:function(e,t,a){},cda3:function(e,t,a){"use strict";a("ac7e")},d2d7:function(e,t,a){Object.defineProperty(t,"__esModule",{value:!0}),t.staticRenderFns=t.render=void 0,a("b0c0");var n=function(){var e=this,t=e._self._c;return t("kdx-modal-frame",{attrs:{title:e.id?"修改标签名称":"创建标签名称",width:500,loading:e.loading},on:{"on-cancel":e.setValue,"on-ok":e.handleOk},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}},[t("div",{staticClass:"label-modal"},[t("Form",{ref:"form",attrs:{model:e.model,rules:e.rules,"label-width":120},nativeOn:{submit:function(e){e.preventDefault()}}},[t("FormItem",{attrs:{label:"标签名称：",prop:"name"}},[t("Input",{staticClass:"width-250",attrs:{type:"text",placeholder:"请输入标签名称"},on:{"on-enter":e.handleOk},model:{value:e.model.name,callback:function(t){e.$set(e.model,"name",t)},expression:"model.name"}}),t("kdx-hint-text",[e._v("不得超过6个汉字或12个字符")])],1)],1)],1)])};t.render=n;var i=[];t.staticRenderFns=i},f64f:function(e,t,a){"use strict";a.r(t);var n=a("2fea"),i=a("4d66");for(var r in i)["default"].indexOf(r)<0&&function(e){a.d(t,e,(function(){return i[e]}))}(r);a("22a4");var s=a("2877"),o=Object(s["a"])(i["default"],n["render"],n["staticRenderFns"],!1,null,"4cd8240f",null);t["default"]=o.exports}}]);