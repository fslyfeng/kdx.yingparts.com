(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[15],{"824a":function(e,t,a){"use strict";var r=a("d216"),n=a.n(r);n.a},"898e":function(e,t,a){var r=a("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(a("e143")),i=new n.default,o=i;t.default=o},"9bd4":function(e,t,a){"use strict";a.r(t);var r=a("c9bf"),n=a("fd2c");for(var i in n)["default"].indexOf(i)<0&&function(e){a.d(t,e,(function(){return n[e]}))}(i);a("824a");var o,c=a("f0c5"),s=Object(c["a"])(n["default"],r["b"],r["c"],!1,null,"386e8c8c",null,!1,r["a"],o);t["default"]=s.exports},"9dd3":function(e,t,a){(function(e){var r=a("4ea4");a("8e6e"),a("ac6a"),a("456d"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("96cf");var n=r(a("1da1"));a("a481");var i=r(a("ade3"));a("c5f6");var o=r(a("5a96")),c=a("2f62"),s=a("a696");a("a28b");function u(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function d(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?u(Object(a),!0).forEach((function(t){(0,i.default)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):u(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var l={name:"OrderPay",components:{payPicker:o.default},props:{orderId:{type:[String,Number,Array]},create:{type:Boolean,default:!1},orderData:{type:Object,default:function(){}},type:{type:String,default:""}},data:function(){return{close_type:0,showOkBtn:!0,showRecharge:!1,showGiveup:!1,showDelivery:!1,showBalance:!1,payType:"",payParams:{},payList:[],stop:!1}},watch:{orderData:{handler:function(e){this.close_type=(null===e||void 0===e?void 0:e.auto_close_type)||0}}},computed:d(d({},(0,c.mapState)("setting",{balance_text:function(e){var t;return(null===(t=e.systemSetting)||void 0===t?void 0:t.balance_text)||"余额"}})),{},{is_weixin:function(){return this.$utils.is_weixin()},return_url:function(){var e,t="";this.is_weixin?t="".concat(this.$utils.getPhoneUrl(),"/kdxOthers/paySuccess"):t="".concat(this.$utils.getPhoneUrl(),"/kdxOrder/paySuccess?id=").concat(this.orderId,"&dispatch_type=").concat(null===(e=this.orderData)||void 0===e?void 0:e.dispatch_type);return t}}),created:function(){},methods:{showPayPicker:function(){this.orderId&&this.getPayList()},getPayList:function(){var e=this,t={order_id:this.orderId};this.orderData.activity_type&&(t.activity_type=this.orderData.activity_type),this.$api.orderApi.getPayList(t).then((function(t){if(0==t.error){var a,r;for(var n in e.payList=[],t.payList)1==t.payList[n].enable&&e.payList.push({type:n});var i=!1;if(e.$utils.is_weixin()||i?e.is_weixin&&i&&(e.payList=e.payList.filter((function(e){return"alipay"!=e.type}))):e.payList=e.payList.filter((function(e){return"wechat"!=e.type})),0===(null===(a=e.payList)||void 0===a?void 0:a.length))e.$toast("未开启支付方式"),e.$emit("handlePayStatus",!1);else if(1===(null===(r=e.payList)||void 0===r?void 0:r.length)){var o,c;e.confirmPay(null===(o=e.payList)||void 0===o||null===(c=o[0])||void 0===c?void 0:c.type)}else e.$refs.createOrderPay.showPayPicker()}else e.$toast(t.message),e.$emit("handlePayStatus",!1)}))},confirmPay:function(e){this.stop||(this.stop=!0,this.payType=e,"balance"==e?this.showBalance=!0:"delivery"==e?(this.$refs.createOrderPay.closePicker(),this.showDelivery=!0):this.handlePay())},closePicker:function(){this.create&&(this.showGiveup=!0)},payment:function(){this.showGiveup=!1,this.$refs.createOrderPay.showPayPicker()},optionsLeave:function(){this.$Router.replace({path:"/kdxOrder/list",query:{status:"all"}})},delivery:function(){this.showDelivery=!1,this.handlePay()},cancelDelivery:function(){this.showDelivery=!1,this.stop=!1,this.$emit("handlePayStatus",!1)},cancelBalance:function(){var e;this.showBalance=!1,this.stop=!1,1===(null===(e=this.payList)||void 0===e?void 0:e.length)&&"balance"==this.payType&&this.create&&this.optionsLeave()},recharge:function(){this.showRecharge=!1,this.$Router.replace({path:"/kdxMember/recharge/index"})},cancelRecharge:function(){this.showRecharge=!1,this.$refs.createOrderPay.showPayPicker()},balancePay:function(){this.showBalance=!1,this.$refs.createOrderPay.closePicker(),uni.showLoading({title:"支付中"}),this.handlePay()},handlePay:function(){var t=this;e.log(Date.now(),"start");var a={};a["return_url"]=this.return_url,e.log(this.return_url,"this.return_url------"),this.$api.orderApi.pay(d({order_id:Array.isArray(this.orderId)?this.orderId:[this.orderId],pay_type:this.payType},a),{errorToast:!1}).then(function(){var a=(0,n.default)(regeneratorRuntime.mark((function a(r){var n,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(211258!=r.error||"balance"!=t.payType){a.next=3;break}return t.changeRechargeState(),a.abrupt("return");case 3:if(0!=r.error){a.next=32;break}if("balance"!=t.payType){a.next=9;break}uni.hideLoading(),t.checkPayStatus(),a.next=30;break;case 9:if("delivery"!=t.payType){a.next=13;break}t.checkPayStatus(),a.next=30;break;case 13:if("alipay"!=t.payType){a.next=17;break}(0,s.wapAliPay)({url:r.data,order_id:t.orderId,dispatch_type:t.orderData.dispatch_type}),a.next=30;break;case 17:if("wechat"!=t.payType){a.next=29;break}return i="",a.next=21,(0,s.wapWechatPay)(d({},r.data));case 21:if(i=a.sent,1!==(null===(n=t.payList)||void 0===n?void 0:n.length)||"wechat"!=t.payType||!t.create||"ok"===i){a.next=25;break}return t.optionsLeave(),a.abrupt("return");case 25:e.log(Date.now(),"start5"),"ok"===i?setTimeout((function(){t.checkPayStatus()}),1e3):t.stop=!1,a.next=30;break;case 29:t.payType;case 30:a.next=36;break;case 32:uni.hideLoading(),setTimeout((function(){t.$message(r.message||"支付失败")}),300),t.$emit("handlePayStatus",!1),t.stop=!1;case 36:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}())},checkPayStatus:function(){var e=this,t={order_id:this.orderId,pay_type:this.payType};this.$api.orderApi.orderPayResult(t).then((function(t){0==t.error?(uni.hideLoading(),e.$toast("支付成功"),e.toCreateResult(),e.stop=!1,e.$emit("handlePayStatus",!1)):setTimeout((function(){e.checkPayStatus()}),2e3)}))},toCreateResult:function(){var e;this.$Router.replace({path:"/kdxOrder/paySuccess",query:{id:this.orderId,dispatch_type:null===(e=this.orderData)||void 0===e?void 0:e.dispatch_type}})},changeRechargeState:function(){var e=this;this.$api.settingApi.getSysSetting().then((function(t){0==t.error&&(e.showOkBtn=1==t.recharge_state)})),uni.hideLoading(),this.showRecharge=!0,this.stop=!1}}};t.default=l}).call(this,a("5a52")["default"])},a696:function(e,t,a){(function(e){var r=a("4ea4");a("8e6e"),a("ac6a"),a("456d"),Object.defineProperty(t,"__esModule",{value:!0}),t.requestOrderPayment=d,t.requestPayment=u,t.wapAliPay=p,t.wapWechatPay=l,a("a481");var n=r(a("ade3")),i=a("a18c"),o=a("325c");function c(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?c(Object(a),!0).forEach((function(t){(0,n.default)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):c(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function u(t){return new Promise((function(a){var r={provider:t.provider};e.log("支付参数--------",r),uni.requestPayment(s(s({},r),{},{success:function(t){e.log(t,"支付success返回结果+++++++++")},fail:function(t){a("fail"),uni.hideLoading(),uni.showToast({title:"支付失败",icon:"none",duration:2e3}),e.log("支付报错信息-----------",t)}}))}))}function d(t){return new Promise((function(a){var r={timeStamp:t.timeStamp,nonceStr:t.nonceStr,package:t.package,signType:t.signType,paySign:t.paySign};t.orderInfo&&(r.orderInfo=t.orderInfo),e.log("支付参数--------requestOrderPayment",r),e.log("paymentData.orderInfo",t.orderInfo),wx.requestOrderPayment(s(s({},r),{},{success:function(t){e.log(t,"支付success返回结果+++++++++requestOrderPayment")},fail:function(t){a("fail"),uni.hideLoading(),uni.showToast({title:"支付失败",icon:"none",duration:2e3}),e.log("支付报错信息-----------requestOrderPayment",t)}}))}))}function l(e){return new Promise((function(t){function a(){WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:e.appId,timeStamp:e.timeStamp?e.timeStamp:e.timestamp,nonceStr:e.nonceStr,package:e.package,signType:e.signType,paySign:e.paySign},(function(e){"get_brand_wcpay_request:ok"==e.err_msg?t("ok"):"get_brand_wcpay_request:cancel"==e.err_msg?(t("cancle"),uni.showToast({title:"取消支付",icon:"none"})):(t("fail"),uni.showToast({title:"支付失败",icon:"none"}))}))}"undefined"==typeof WeixinJSBridge?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",a,!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",a),document.attachEvent("onWeixinJSBridgeReady",a)):a()}))}function p(e){var t=(0,o.is_weixin)();t?i.router.replace({path:"/kdxOrder/alipay",query:{url_alipay:e.url,id:Array.isArray(e.order_id)?e.order_id.join(","):e.order_id,couponId:e.couponId||"",pageFrom:e.pageFrom||"",dispatch_type:e.dispatch_type,orderID:Array.isArray(e.order_id)?1:0}}):location.href=e.url}}).call(this,a("5a52")["default"])},c9bf:function(e,t,a){"use strict";var r;a.d(t,"b",(function(){return n})),a.d(t,"c",(function(){return i})),a.d(t,"a",(function(){return r}));var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-uni-view",{staticClass:"order-pay"},[a("pay-picker",{ref:"createOrderPay",attrs:{payList:e.payList},on:{confirmPay:function(t){arguments[0]=t=e.$handleEvent(t),e.confirmPay.apply(void 0,arguments)},closePicker:function(t){arguments[0]=t=e.$handleEvent(t),e.closePicker.apply(void 0,arguments)}}}),a("rr-modal",{attrs:{title:"确定货到付款？"},on:{handlerOK:function(t){arguments[0]=t=e.$handleEvent(t),e.delivery.apply(void 0,arguments)},handlerCancel:function(t){arguments[0]=t=e.$handleEvent(t),e.cancelDelivery.apply(void 0,arguments)}},model:{value:e.showDelivery,callback:function(t){e.showDelivery=t},expression:"showDelivery"}}),a("rr-modal",{attrs:{showOkBtn:e.showOkBtn,title:"提示",subtitle:"对不起，您的"+e.balance_text+"不足请立即进行充值",cancelText:"取消支付",okText:"立即充值"},on:{handlerOK:function(t){arguments[0]=t=e.$handleEvent(t),e.recharge.apply(void 0,arguments)},handlerCancel:function(t){arguments[0]=t=e.$handleEvent(t),e.cancelRecharge.apply(void 0,arguments)}},model:{value:e.showRecharge,callback:function(t){e.showRecharge=t},expression:"showRecharge"}}),a("rr-modal",{attrs:{title:"确定用"+e.balance_text+"支付吗？"},on:{handlerOK:function(t){arguments[0]=t=e.$handleEvent(t),e.balancePay.apply(void 0,arguments)},handlerCancel:function(t){arguments[0]=t=e.$handleEvent(t),e.cancelBalance.apply(void 0,arguments)}},model:{value:e.showBalance,callback:function(t){e.showBalance=t},expression:"showBalance"}}),a("rr-modal",{attrs:{title:"确定取消订单吗？","ok-text":"我再想想","cancel-text":"去意已决"},on:{handlerOK:function(t){arguments[0]=t=e.$handleEvent(t),e.payment.apply(void 0,arguments)},handlerCancel:function(t){arguments[0]=t=e.$handleEvent(t),e.optionsLeave.apply(void 0,arguments)}},model:{value:e.showGiveup,callback:function(t){e.showGiveup=t},expression:"showGiveup"}},[2==e.close_type?a("template",{slot:"content"},[a("v-uni-view",{staticClass:"pay-modal-content"},[e._v("您的订单在"+e._s(e.orderData.auto_close_time)+"分钟内未支付将被取消，请尽快完成支付")])],1):e._e()],2)],1)},i=[]},d216:function(e,t,a){var r=a("f57f");"string"===typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);var n=a("4f06").default;n("fb33ee5c",r,!0,{sourceMap:!1,shadowMode:!1})},f57f:function(e,t,a){var r=a("24fb");t=r(!1),t.push([e.i,'@charset "UTF-8";\r\n/**\r\n * 开店星新零售管理系统\r\n * @description 基于Yii2+Vue2.0+uniapp研发，H5+小程序+公众号全渠道覆盖，功能完善开箱即用，框架成熟易扩展二开\r\n * @author 青岛开店星信息技术有限公司\r\n * @link https://www.kaidianxing.com\r\n * @copyright Copyright (c) 2020-2022 Qingdao ShopStar Information Technology Co., Ltd.\r\n * @copyright 版权归青岛开店星信息技术有限公司所有\r\n * @warning Unauthorized deletion of copyright information is prohibited.\r\n * @warning 未经许可禁止私自删除版权信息\r\n */\r\n/* 颜色变量 */\r\n/* 行为相关颜色 */\r\n/* 文字基本颜色 */\r\n/* 背景颜色 */\r\n/* 边框颜色 */\r\n/* 尺寸变量 */\r\n/* 文字尺寸 */\r\n/* 图片尺寸 */\r\n/* Border Radius */\r\n/* 水平间距 */\r\n/* 垂直间距 */\r\n/* 透明度 */\r\n/* 文章场景相关 */.order-pay .pay-modal-content[data-v-386e8c8c]{font-size:%?24?%}',""]),e.exports=t},fd2c:function(e,t,a){"use strict";a.r(t);var r=a("9dd3"),n=a.n(r);for(var i in r)["default"].indexOf(i)<0&&function(e){a.d(t,e,(function(){return r[e]}))}(i);t["default"]=n.a}}]);